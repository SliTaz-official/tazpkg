#!/bin/sh
#
# List installed packages in a suitable format for GTK tree.
# List mirrored packages using the packages.desc file.
#

case $1 in
	installed)
		CAT=`cat /tmp/tazpkgbox/installed-category`
		if [ "$CAT" == "all" ]; then
			for pkg in /var/lib/tazpkg/installed/*
			do
				. $pkg/receipt
				echo "$PACKAGE|$VERSION|$SHORT_DESC"
			done
		else
			for pkg in /var/lib/tazpkg/installed/*
			do
				. $pkg/receipt
				if [ "$CATEGORY" == "$CAT" ]; then
					echo "$PACKAGE|$VERSION|$SHORT_DESC"
				fi
			done	
		fi ;;
	mirrored)
		CAT=`cat /tmp/tazpkgbox/mirrored-category`
		if [ "$CAT" == "all" ]; then
			cat /var/lib/tazpkg/packages.desc
		else
			grep "$CAT" /var/lib/tazpkg/packages.desc
			#for pkg in `grep "$CAT" /var/lib/tazpkg/packages.desc | cut -d "|" -f 1`
			#do
				#RES=`grep "^$pkg"  /var/lib/tazpkg/packages.desc | head -n 1`
				#CATEGORY=`echo "$RES" | cut -d "|" -f 4`
				##echo "$pkg|$CATEGORY"
				#if [ "$CATEGORY" == "$CAT" ]; then
					#VERSION=`echo $RES | cut -d "|" -f 2`
					#SHORT_DESC=`echo $RES | cut -d "|" -f 3`
					#echo "$pkg | $VERSION | $SHORT_DESC"
				#fi
			#done
		fi ;;
	*)
		echo "Usage: /usr/lib/slitaz/tazpkgbox/list [installed|mirrored]" ;;
esac

exit 0
